<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Modernizing ImpactJS - Part 1 : The Modules</title>
  <meta name="description" content="If you were interested in making games for the web between 2010 and 2014, chances are that you landed at least once on the ImpactJS front page. This was (and...">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://scambier.github.io/2017/10/30/modernizing-impactjs-part-1-modules.html">
  <link rel="alternate" type="application/rss+xml" title="scambier.github.io" href="/feed.xml">

  <base href="https://scambier.github.io/">

  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-100468744-1', 'auto');
  ga('send', 'pageview');

</script>
  

  

  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@_scambier">
  <meta name="twitter:creator" content="@_scambier">
  
    <meta name="twitter:title" content="Modernizing ImpactJS - Part 1 : The Modules">
  
  
    <meta name="twitter:description" content="If you were interested in making games for the web between 2010 and 2014, chances are that you landed at...">
  
  
    <meta name="twitter:image:src" content="https://scambier.github.io/assets/images/2017/10/ng-15320.jpg">
  

</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">scambier.github.io</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
            <a class="page-link" href="/projects/">Projects</a>
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <header class="post-header">
  <p class="post-meta">
    <time datetime="2017-10-30T19:43:00+01:00" itemprop="datePublished">
      
      Oct 30, 2017
    </time>
    </p>
    
    <h1 class="post-title" itemprop="name headline">Modernizing ImpactJS - Part 1 : The Modules</h1>
</header>

<figure  class="post-full-image" style="background-image: url('https://scambier.github.io/assets/images/2017/10/ng-15320.jpg');" ></figure>

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">


  <div class="post-full-content" itemprop="articleBody">
    <p>If you were interested in making games for the web between 2010 and 2014, chances are that you landed at least once on the <a href="http://impactjs.com/">ImpactJS front page</a>. This was (and still is) a really great engine. It packs a map editor, an entity system, basic physics and collisions...</p>

<p>I still like to prototype a bit with ImpactJS every once in a while. You can quickly have a running project, and I&#39;ve used it a few times for Ludum Dares. But while the engine&#39;s code is well written and legible, it feels ancient. I wanted to dust it off to make use of more modern Javascript&#39;s features, like npm packages and ES6 modules.</p>

<p>In this post (and the followings), I will explain how ImpactJS works, and what steps I took to rise it to modern JS quality levels.</p>

<p><strong>Disclaimer:</strong> because ImpactJS source code is not free (both meanings), I can only show code that is outside the scope of the engine itself.</p>

<p><br /></p>

<h1>Part 1 - The modules</h1>

<p><br /></p>

<p>Here is how an ImpactJS module looks like:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">ig</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span> 
    <span class="s1">&#39;game.main&#39;</span> 
<span class="p">)</span>
<span class="p">.</span><span class="nx">requires</span><span class="p">(</span>
    <span class="s1">&#39;impact.game&#39;</span><span class="p">,</span>
    <span class="s1">&#39;impact.font&#39;</span>
<span class="p">)</span>
<span class="p">.</span><span class="nx">defines</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

    <span class="nx">MyGame</span> <span class="o">=</span> <span class="nx">ig</span><span class="p">.</span><span class="nx">Game</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
        <span class="nx">font</span><span class="o">:</span> <span class="k">new</span> <span class="nx">ig</span><span class="p">.</span><span class="nx">Font</span><span class="p">(</span> <span class="s1">&#39;media/font.png&#39;</span> <span class="p">),</span>

        <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{},</span>

        <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>
        <span class="p">},</span>

        <span class="nx">draw</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">font</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">ig</span><span class="p">.</span><span class="nx">Font</span><span class="p">.</span><span class="nx">ALIGN</span><span class="p">.</span><span class="nx">CENTER</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="nx">ig</span><span class="p">.</span><span class="nx">main</span><span class="p">(</span> <span class="s1">&#39;#canvas&#39;</span><span class="p">,</span> <span class="nx">MyGame</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">2</span> <span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>It&#39;s pretty straightforward:<br>
<code>ig.module()</code> defines the module name, which must match its path and filename.<br>
<code>.requires()</code> makes sure that the listed modules are correctly loaded before the current one.<br>
<code>.defines()</code> contains the code that will be executed, once the module is loaded.</p>

<p>You can see that the class <code>MyGame</code> is globally declared, because Impact&#39;s modules do not export data. Thus, all classes/variables must either be globally declared, or added as attributes of a global object (like <code>ig</code>).</p>

<p>How does it work under the hood? Pretty simply. When the game is loaded in dev mode, ImpactJS appends a <code>&lt;script&gt;</code> tag for each module called in <code>requires()</code>. Those modules are then executed by the browser, have their own <code>requires()</code> and so on. Once all the dependencies have been recursively added, the game can start. If the scope of your game is modest, this method is fast and convenient enough. When you build the game for distribution, all modules are concatenated in order and minified.</p>

<h2>Now, how to improve those modules?</h2>

<p>As my short-term goal is to make Impact ES6-compatible, I&#39;ve easily replaced the old syntax with <code>import</code> and <code>export</code> statements without changing too much code. The engine&#39;s code itself is still riddled of globals that can be cleaned later, but the code I&#39;ll write for my game can be much more ES6 friendly.</p>

<p>The <code>game.main</code> that I showed above now looks like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span><span class="nx">ig</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../impact/ig.js&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Game</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../impact/game.js&#39;</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span><span class="nx">Font</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../impact/font.js&#39;</span><span class="p">;</span>

<span class="kd">let</span> <span class="nx">MyGame</span> <span class="o">=</span> <span class="nx">Game</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
  <span class="nx">font</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Font</span><span class="p">(</span><span class="s1">&#39;media/font.png&#39;</span><span class="p">),</span>

  <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{},</span>

  <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>
  <span class="p">},</span>

  <span class="nx">draw</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">parent</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">font</span><span class="p">.</span><span class="nx">draw</span><span class="p">(</span><span class="s1">&#39;Hello World&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
  <span class="p">},</span>
<span class="p">});</span>

<span class="nx">ig</span><span class="p">.</span><span class="nx">main</span><span class="p">(</span><span class="s1">&#39;#canvas&#39;</span><span class="p">,</span> <span class="nx">MyGame</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></div>
<p>It works as good as before, the code is already cleaner, and my IDE autocompletion is smarter.</p>

<p>Best of all, as evergreen browsers support ES6 modules, I don&#39;t even need a build step during development. Or do I?</p>

<p>Stay tuned for our next episode, <em>&quot;Part 2 - Time for a Brunch!&quot;</em></p>

<hr>

<p><br />
<small>Photo by <a href="https://unsplash.com/photos/8Gg2Ne_uTcM?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">贝莉儿 NG</a> on Unsplash</small></p>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">scambier.github.io</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              scambier.github.io
            
            </li>
            
            <li><a href="mailto:cambier.simon@gmail.com">cambier.simon@gmail.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/scambier"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">scambier</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/@_scambier"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">@_scambier</span></a>

          </li>
          

          
          <li>
            <a href="https://www.linkedin.com/in/simon-cambier-163b0348/"><i class="fa fa-linkedin-square icon" style="color:#828282" aria-hidden="true"></i>&nbsp;&nbsp;<span class="username">Simon Cambier</span></a>

          </li>
          

        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Code &amp; Games. Mainly code, tough.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
